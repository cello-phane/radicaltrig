<!DOCTYPE html>
<html lang="en"data-theme="light">
<head>
<title>Clock Widget</title>
<link href="css/style_perspective_sphere.css" rel="stylesheet" type="text/css"/>
<script src="js/rau.js"></script>
<script>

// === Precompute RAU sin/cos for 60 divisions (seconds) ===
const rauSinTable = [], rauCosTable = [];
for (let i = 0; i < 60; i++) {
  const t = (i / 60) * 4; // full circle in RAU
  rauSinTable.push(radicalSine(t));
  rauCosTable.push(radicalCosine(t));
}

// === Draw clock ===
function drawRAUClock(ctx, width, height, scaleFactor) {
  ctx.save();
  ctx.clearRect(0, 0, width, height);
  const cx = 2;
  const cy = 2;

  // move origin to canvas center
  ctx.translate(width / 2, height / 2);

  // scale the coordinate system
  ctx.scale(scaleFactor, scaleFactor);

  const radius = Math.min(width, height) * 0.45;

  // draw everything centered around (0,0)
  ctx.beginPath();
  ctx.arc(0, 0, radius, 0, 2 * Math.PI);
  ctx.stroke();

  // Tick marks
  ctx.lineWidth = 1;

  // Time
  const now = new Date();
  const sec = now.getSeconds() + now.getMilliseconds() / 1000;
  const min = now.getMinutes() + sec / 60;
  const hr = (now.getHours() % 12) + min / 60;

  // Convert to RAU (4 = full turn)
  const secRAU = (sec / 60) * 4;
  const minRAU = (min / 60) * 4;
  const hrRAU = (hr / 12) * 4;
  
  const outerRX = 320, outerRY = 340;
  const innerRX = 70, innerRY = 50;
  
  rauSinTable.forEach((val, i) => {
    const cosVal = rauCosTable[i];
  
    // tick mark conditions
    if ((i % 5 === 0 && i % 2 === 0) || i % 15 === 0 ||
        (i % 6 === 0 && (i < 40 && i > 20)) ||
        (i % 6 === 0 && (i < 10 || i > 50))) {
  
      const sx = cx + val * outerRX * 0.85;
      const sy = cy - cosVal * outerRY * 0.85;
      const ex = cx + val * outerRX * 0.95;
      const ey = cy - cosVal * outerRY * 0.95;
      ctx.beginPath();
      ctx.moveTo(sx, sy);
      ctx.lineTo(ex, ey);
      ctx.stroke();
    }
  
    // fancy symbol thing
    const next = (i + 1) % 60;
    const prev = (i + 59) % 60;
    const s = 0.45, e = 0.55;
  
    const sx  = cx + rauSinTable[next] * innerRX * s;
    const sy  = cy - rauCosTable[prev] * innerRY * s;
    const ex  = cx + rauSinTable[prev] * innerRX * e;
    const ey  = cy - rauCosTable[next] * innerRY * e;
  
    const sxb = cx + rauSinTable[prev] * innerRX * s;
    const syb = cy - rauCosTable[next] * innerRY * s;
    const exb = cx + rauSinTable[next] * innerRX * e;
    const eyb = cy - rauCosTable[prev] * innerRY * e;
  
    ctx.beginPath();
    ctx.moveTo(sx, sy); ctx.lineTo(ex, ey);
    ctx.moveTo(sxb, syb); ctx.lineTo(exb, eyb);
    ctx.stroke();
  });
  


  // Hands
  drawHand(ctx, cx, cy, radius * 0.9, radicalSine(secRAU), radicalCosine(secRAU), "red", 2);
  drawHand(ctx, cx, cy, radius * 0.7, radicalSine(minRAU), radicalCosine(minRAU), "blue", 4);
  drawHand(ctx, cx, cy, radius * 0.5, radicalSine(hrRAU), radicalCosine(hrRAU), "black", 6);

  ctx.restore();
}

function drawHand(ctx, cx, cy, len, sin, cos, color, width) {
  ctx.beginPath();
  ctx.moveTo(cx, cy);
  ctx.lineTo(cx + len * sin, cy - len * cos);
  ctx.strokeStyle = color;
  ctx.lineWidth = width;
  ctx.lineCap = "round";
  ctx.stroke();
}

// === Animate ===
function startRAUClock() {
  const canvas = document.getElementById("rauClock");
  canvas.style.position = 'absolute';
  canvas.style.top = '50%'; //Move Down
  canvas.style.left = '50%'; //Move right
  canvas.style.transform = 'translate(-50%, -50%)'; // perfectly center in viewport
  const ctx = canvas.getContext("2d");
  const sizePercentageOfClock = 0.95;
  function loop() {
    drawRAUClock(ctx, canvas.width, canvas.height, sizePercentageOfClock);
    requestAnimationFrame(loop);
  }
  loop();
}

document.addEventListener("DOMContentLoaded", startRAUClock);
</script>
</head>
<body>
<canvas id="rauClock" width="650" height="650" style="border:2px solid #444; border-radius:50%; display:block; margin:auto;"></canvas>
</body>
</html>
