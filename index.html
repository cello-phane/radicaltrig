<!DOCTYPE html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- <meta http-equiv="Content-Security-Policy" content="script-src 'unsafe-inline' https://cdn.jsdelivr.net https://cello-phane.github.io; script-src-elem 'unsafe-inline' https://cdn.jsdelivr.net https://cello-phane.github.io"> -->

    <title>Radical Angle Unit - Vector Visualization</title>
    <link rel="stylesheet" href="css/style.css">
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [
                    ['$', '$'],
                    ['\\(', '\\)']
                ]
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
</head>

<body>
    <header>
        <h1>Radical Angle Unit - Vector Visualization</h1>
        <button id="toggleButton" class="toggle-btn">Switch to Vector Diagram</button>
        <button id="themeToggle" class="toggle-btn">ðŸŒ™ Dark Mode</button>
    </header>

    <div id="formulaPanel">
        <div id="formulaHeader">
            <div class="title">Sidebar</div>
            <div class="chev" id="formulaChevron">â—€</div>
        </div>
        <button onclick="toggleMathBlock()">Formulae</button>
		  
        <button onclick="changeFontSize(1,'resultsContent')">+</button>
        <button onclick="changeFontSize(-1,'resultsContent')">-</button>
		<button id="toggleHeaderControls" style="float:right">â—€</button>
		<div id="mathBlock" class="collapsed">
   	        <p style="margin:0 0 5px 0;">\(0.0 < t < 1.0\)</p>
   	        <div>\[\mathrm{rsin}(t)=\frac{t}{\sqrt{1-2t+2t^2}}\]</div>
   	        <div>\[\mathrm{rcos}(t)=\frac{1-t}{\sqrt{1-2t+2t^2}}\]</div>
   	        <div>\[\mathrm{rtan}(t)=\frac{t}{1-t}\]</div>
   	        <div>\[\mathrm{Inverse\ Functions (-1 < t <1)}\]</div>
   	        <div>\[\mathrm{rsin^{-1}}(t)=\frac{t^2-\sqrt{t^2-t^4}}{2t^2-1}\]</div>
   	        <div>\[\mathrm{rcos^{-1}}(t)=\frac{t^2-1+\sqrt{t^2-t^4}}{2t^2-1}\]</div>
   	        <div>\[\mathrm{rtan^{-1}}(t)=\frac{t}{1+t}\]</div>
   	      </div>
        <div id="formulaBody">
       	   
            <!-- Vector canvas only control -->
            <div id="angleModeSidebar" style="display:none; margin: 12px 0; padding: 8px; border: 1px solid #ddd; border-radius: 6px;">
                <label for="angleMode" style="display: block; font-weight: 600; margin-bottom: 8px;">Display Mode:</label> 
                <select id="angleMode">
                    <option value="between">Angle Between Vectors</option>
                    <option value="individual">Individual Vector Angles</option>
                </select>
            </div>

            <pre id="resultsContent"></pre>
        </div>
    </div>
    <div class="content">
      <section id="section1" class="active">
          <div class="card" style="position: relative; width: 100%; max-width: 600px; margin: 0 auto;background:transparent;">
              <h2>Introduction to RAU</h2>
              <div class="desc"><strong>Quadrant-aware modular arithmetic</strong> - RAU maps a linear parameter (0â€“4) to a circle using integer and fractional parts.
              </div>
              <link rel="stylesheet" href="css/intro.css"> 
              <div style="position: relative; width: 100%; max-width: 600px; margin: 0 auto;">
                  <!-- Canvas (interactive) -->
                  <canvas id="simpleCanvas" width="600" height="400" style="display: block; z-index: 1; position: relative;">
                  </canvas>

                  <!-- SVG overlay (non-interactive, visual only) -->
                  <svg id="prosvg" viewBox="-260 -5 517 11" preserveAspectRatio="xMidYMid meet" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
		             z-index: 2; pointer-events: none; display: block;">
                  </svg>
              </div>

              <div class="controls">
                  <div style="displaY: flex;" class="controls">
                      <label style="margin-top:8px;">Radical Angle Unit:</label>
                      <input aria-label="Phase(Angle)" type="range" id="paramSlider" min="0" max="4" step="0.0001" value="0" />
                      <input type="text" id="paramValue" style="width:8.5%;" name="RAU angle" />
                  </div>
              </div>
              <div class="row">
                  <label style="flex:1">Ticks:</label>
                  <input id="tickCount" type="range" min="4" max="120" step="4" value="72" />
                  <div class="small" id="tickVal">72</div>
              </div>

              <div class="row">
                  <label style="flex:1">Label mode:</label>
                  <select id="labelMode">
                      <option value="t">t (RAU param)</option>
                      <option value="deg">degrees</option>
                      <option value="rad">radians</option>
                      <option value="none">none</option>
                  </select>
              </div>

          </div>
          <!-- Derivation Canvas - Added seamlessly below RAU Protractor -->
          <div class="card" style="margin-top: 20px;">
              <h2>Diagonal Derivation</h2>
              <div class="desc">Visual proof: How RAU formulas emerge from diagonal parameterization</div>
              <canvas id="derivCanvas" width="750" height="650" style="display: block; margin: 0 auto; background: transparent;"></canvas>
              
              <div class="controls" style="margin-top: 20px;">
                  <div class="control-group">
                      <label>Parameter t (along diagonal): <span class="value" id="derivTValue">0.500</span></label>
                      <input type="range" id="derivTSlider" min="0" max="1" value="0.5" step="0.001" style="width: 100%;">
                  </div>
                  
                  <div class="row">
                      <label><input type="checkbox" id="derivShowGrid" checked> Grid</label>
                      <label><input type="checkbox" id="derivShowLabels" checked> Labels</label>
                      <label><input type="checkbox" id="derivShowConstruction" checked> Construction</label>
                  </div>
                  
                  <div style="display: flex; gap: 8px; margin-top: 12px;">
                      <button onclick="setDerivT(0)">t=0</button>
                      <button onclick="setDerivT(0.25)">t=0.25</button>
                      <button onclick="setDerivT(0.5)">t=0.5</button>
                      <button onclick="setDerivT(0.75)">t=0.75</button>
                      <button onclick="setDerivT(1)">t=1</button>
                  </div>
                  
                  <div style="margin-top: 16px; padding: 12px; background: var(--control-bg); border-radius: 6px; font-size: 12px; line-height: 1.6;">
                      <strong style="color: var(--accent);">Point on Diagonal:</strong><br>
                      (1-t, t) = (<span id="derivDiagX">0.500</span>, <span id="derivDiagY">0.500</span>)<br><br>
                      
                      <strong style="color: var(--accent);">Distance r:</strong> 
                      âˆš(1 - 2t + 2tÂ²) = <span id="derivR">0.707</span><br><br>
                      
                      <strong style="color: var(--accent);">On Unit Circle:</strong><br>
                      rcos = (1-t)/r = <span id="derivCos">0.707</span><br>
                      rsin = t/r = <span id="derivSin">0.707</span><br>
                      Angle: <span id="derivAngle">45.0Â°</span>
                  </div>
              </div>
          </div>
          
          <script>
          // ===== DERIVATION CANVAS - Added to existing app =====
          (function() {
              const canvas = document.getElementById('derivCanvas');
              if (!canvas) return;
              
              const ctx = canvas.getContext('2d');
              const scale = 250;
              const centerX = canvas.width / 2;
              const centerY = canvas.height / 2;
              
              function toCanvas(x, y) {
                  return { x: centerX + x * scale, y: centerY - y * scale };
              }
              
              function getColors() {
                  const isDark = document.body.classList.contains('dark-mode');
                  return {
                      grid: isDark ? '#1a1a2e' : '#e0e0e0',
                      axis: isDark ? '#555' : '#999',
                      circle: isDark ? '#00ff88' : '#0066cc',
                      diagonal: isDark ? '#ffa500' : '#ff8800',
                      construction: isDark ? '#00d4ff' : '#0088cc',
                      line: isDark ? '#ff6b9d' : '#cc0066',
                      angle: isDark ? '#ffd93d' : '#ffaa00',
                      text: isDark ? '#eee' : '#333'
                  };
              }
              
              function drawDerivation() {
                  const colors = getColors();
                  const t = parseFloat(document.getElementById('derivTSlider').value);
                  const showGrid = document.getElementById('derivShowGrid').checked;
                  const showLabels = document.getElementById('derivShowLabels').checked;
                  const showConstruction = document.getElementById('derivShowConstruction').checked;
                  
                  ctx.clearRect(0, 0, canvas.width, canvas.height);
                  
                  // Grid
                  if (showGrid) {
                      ctx.strokeStyle = colors.grid;
                      ctx.lineWidth = 1;
                      for (let i = -2; i <= 2; i += 0.2) {
                          const p1 = toCanvas(i, -2), p2 = toCanvas(i, 2);
                          ctx.beginPath();
                          ctx.moveTo(p1.x, p1.y);
                          ctx.lineTo(p2.x, p2.y);
                          ctx.stroke();
                          
                          const p3 = toCanvas(-2, i), p4 = toCanvas(2, i);
                          ctx.beginPath();
                          ctx.moveTo(p3.x, p3.y);
                          ctx.lineTo(p4.x, p4.y);
                          ctx.stroke();
                      }
                  }
                  
                  // Axes
                  ctx.strokeStyle = colors.axis;
                  ctx.lineWidth = 2;
                  const xStart = toCanvas(-1.3, 0), xEnd = toCanvas(1.3, 0);
                  ctx.beginPath();
                  ctx.moveTo(xStart.x, xStart.y);
                  ctx.lineTo(xEnd.x, xEnd.y);
                  ctx.stroke();
                  
                  const yStart = toCanvas(0, -1.3), yEnd = toCanvas(0, 1.3);
                  ctx.beginPath();
                  ctx.moveTo(yStart.x, yStart.y);
                  ctx.lineTo(yEnd.x, yEnd.y);
                  ctx.stroke();
                  
                  // Unit circle
                  const center = toCanvas(0, 0);
                  ctx.strokeStyle = colors.circle;
                  ctx.lineWidth = 2;
                  ctx.beginPath();
                  ctx.arc(center.x, center.y, scale, 0, 2 * Math.PI);
                  ctx.stroke();
                  
                  // Diagonal line
                  const p1 = toCanvas(1, 0), p2 = toCanvas(0, 1);
                  ctx.strokeStyle = colors.diagonal;
                  ctx.lineWidth = 4;
                  ctx.beginPath();
                  ctx.moveTo(p1.x, p1.y);
                  ctx.lineTo(p2.x, p2.y);
                  ctx.stroke();
                  
                  // Calculations
                  const diagX = 1 - t, diagY = t;
                  const r = Math.sqrt(1 - 2*t + 2*t*t);
                  const circleX = diagX / r, circleY = diagY / r;
                  
                  const pDiag = toCanvas(diagX, diagY);
                  const pCircle = toCanvas(circleX, circleY);
                  const origin = toCanvas(0, 0);
                  
                  // Construction lines
                  if (showConstruction) {
                      ctx.strokeStyle = colors.construction;
                      ctx.lineWidth = 3;
                      ctx.setLineDash([5, 5]);
                      ctx.beginPath();
                      ctx.moveTo(origin.x, origin.y);
                      ctx.lineTo(pDiag.x, pDiag.y);
                      ctx.stroke();
                      ctx.setLineDash([]);
                  }
                  
                  // Line to circle
                  ctx.strokeStyle = colors.line;
                  ctx.lineWidth = 3;
                  ctx.beginPath();
                  ctx.moveTo(origin.x, origin.y);
                  ctx.lineTo(pCircle.x, pCircle.y);
                  ctx.stroke();
                  
                  // Points
                  ctx.fillStyle = colors.diagonal;
                  ctx.beginPath();
                  ctx.arc(pDiag.x, pDiag.y, 6, 0, 2 * Math.PI);
                  ctx.fill();
                  
                  ctx.fillStyle = colors.line;
                  ctx.beginPath();
                  ctx.arc(pCircle.x, pCircle.y, 7, 0, 2 * Math.PI);
                  ctx.fill();
                  
                  // Angle arc
                  const angleRad = Math.atan2(circleY, circleX);
                  ctx.strokeStyle = colors.angle;
                  ctx.lineWidth = 2;
                  ctx.beginPath();
                  ctx.arc(origin.x, origin.y, scale * 0.2, 0, -angleRad, true);
                  ctx.stroke();
                  
                  // Update displays
                  document.getElementById('derivTValue').textContent = t.toFixed(3);
                  document.getElementById('derivDiagX').textContent = diagX.toFixed(3);
                  document.getElementById('derivDiagY').textContent = diagY.toFixed(3);
                  document.getElementById('derivR').textContent = r.toFixed(3);
                  document.getElementById('derivCos').textContent = circleX.toFixed(3);
                  document.getElementById('derivSin').textContent = circleY.toFixed(3);
                  document.getElementById('derivAngle').textContent = (angleRad * 180 / Math.PI).toFixed(1) + 'Â°';
              }
              
              window.setDerivT = function(value) {
                  document.getElementById('derivTSlider').value = value;
                  drawDerivation();
              };
              
              // Event listeners
              document.getElementById('derivTSlider').addEventListener('input', drawDerivation);
              document.getElementById('derivShowGrid').addEventListener('change', drawDerivation);
              document.getElementById('derivShowLabels').addEventListener('change', drawDerivation);
              document.getElementById('derivShowConstruction').addEventListener('change', drawDerivation);
              document.getElementById('themeToggle').addEventListener('click', () => setTimeout(drawDerivation, 50));
              
              // Initial draw
              drawDerivation();
          })();
          </script>
      </section>

	    <section id="section2" class"inactive">
	        <div class="card">
	            <h2>Radical Angle Unit as: |cross| / (|cross| + |dot|)</h2>
	            <canvas id="vectorCanvas" width="600" height="400"></canvas>
	            <div class="panel">
	                <div>
	                    <div class="control-group">
	                        <label for="uLength">u length:</label>
	                        <input id="uLength" type="range" min="1" max="200" value="120">
	                        <div class="value" id="uLengthVal">120</div>
	                    </div>
	                    <div class="control-group">
	                        <label for="uAngle">u rotate:</label>
	                        <input id="uAngle" type="range" min="0.0" max="360.0" step="1.0" value="30.0">
	                        <div class="value" id="uAngleVal">30Â°</div>
	                    </div>
	                    <div class="control-group">
	                        <label for="vLength">v length:</label>
	                        <input id="vLength" type="range" min="1" max="200" value="100">
	                        <div class="value" id="vLengthVal">100</div>
	                    </div>
	                    <div class="control-group">
	                        <label for="vAngle">v rotate:</label>
	                        <input id="vAngle" type="range" min="0.0" max="360.0" step="1.0" value="90.0">
	                        <div class="value" id="vAngleVal">90Â°</div>
	                    </div>
	                </div>

	                <div class="displayProperties">
	                    <table>
								<tr>
	                            <td><label for="wrappedAngle">Wrap Angle Arc</label></td>
	                            <td><input type="checkbox" id="wrappedAngle" name="wrappedAngle"></td>
	                        </tr>
	                        <tr>
	                            <td><label for="biasAngle">Bias Angle Arc</label></td>
	                            <td><input type="checkbox" id="biasAngle" name="biasAngle"></td>
	                        </tr>	                        
	                        <tr>
	                            <td><label for="defaultAngle">Between Arc</label></td>
	                            <td><input type="checkbox" id="defaultAngle" name="defaultAngle"></td>
	                        </tr>
	                    </table>
	                </div>
	            </div>
				</div>
	    </section>
    </div>
    <script src="js/main.js"></script>
    <script src="js/geom.js"></script>
    <script src="js/vectorDraw.js"></script>
    <script src="js/uiControls.js"></script>
    <script src="js/protractor.js"></script>
</body>

</html>
