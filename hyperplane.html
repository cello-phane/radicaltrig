<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hyperplane</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #0a0a0a;
            color: white;
            font-family: monospace;
            overflow: hidden;
        }
        
        canvas {
            display: block;
            margin: 0 auto;
            background: #000;
			z-index: 1;
			position: relative;
        }
        
        canvas.fullscreen {
            width: 100vw !important;
            height: 100vh !important;
        }
        
        #controlsContainer {
            position: absolute;
            top: 60px;
            left: 20px;
            background: rgba(0,0,0,0.9);
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #00ff88;
            display: block;
			z-index: 2;
        }
        
        .control-group {
            margin-bottom: 10px;
        }
        
        label {
            display: inline-block;
            width: 140px;
            font-size: 12px;
        }
        
        input[type="range"] {
            width: 120px;
        }
        
        input[type="checkbox"] {
            margin-left: 5px;
        }
        
        .value {
            color: #00ff88;
            font-weight: bold;
            font-size: 12px;
        }
        
        h3 {
            margin: 0 0 10px 0;
            font-size: 14px;
            color: #00ff88;
        }

		.mainContainer {
			position: relative;
        }

		.fullscreen-toggle {
            position: absolute;
			top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.9);
            color: #00ff88;
            border: 2px solid #00ff88;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-family: monospace;
            font-size: 12px;
            font-weight: bold;
			z-index: 2;
        }
        
        .fullscreen-toggle:hover {
            background: rgba(0,255,136,0.2);
        }
        
        .controls-toggle {
	        top: 20px;
	        right: 20px;
	        background: rgba(0,0,0,0.9);
	        color: #00ff88;
	        border: 2px solid #00ff88;
	        padding: 10px 15px;
	        border-radius: 8px;
	        cursor: pointer;
	        font-family: monospace;
	        font-size: 12px;
	        font-weight: bold;
			position: relative;
			z-index: 2;
        }
        
        .controls-toggle:hover {
            background: rgba(0,255,136,0.2);
        }
        
        button {
            background: var(--button-bg);
            color: var(--button);
            border: var(--button-border);
            padding: 8px 14px;
            border-radius: 2px;
            cursor: pointer;
            margin-right: 8px;
            margin-bottom: 8px;
            font-size: 11px;
            font-family: inherit;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            font-weight: normal;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
			z-index: 2;
        }
        
        button:hover {
            background: var(--button-hover-bg);
            box-shadow: var(--button-hover-shadow);
        }
        
        button:active {
            box-shadow: var(--button-active-shadow);
        }
        
        button.active {
            background: var(--button-active-bg);
            border-color: var(--button-active-border);
        }
        
        button#toggleCtrls {
            top: 20px;
            left: 20px;
            z-index: 2;
        }
    </style>
</head>
<body>
    

    <div id="mainContainer">
	<button class="fullscreen-toggle" id="fullscreenToggle">&#x26F6;</button>
    <button class="controls-toggle" id="toggleCtrls" onclick="hideControls();">&#247;</button>
	  <div id="controlsContainer">

        <h3>Controls</h3>

        <div class="control-group">
            <label>Show Transcendental:</label>
            <input type="checkbox" id="showTranscendental" checked>
        </div>
        
        <div class="control-group">
            <label>Show Axes:</label>
            <input type="checkbox" id="showAxes" checked>
        </div>
        
        <div class="control-group">
            <label>Radical Mode (RAU):</label>
            <input type="checkbox" id="radicalMode">
        </div>
        
        <div class="control-group">
            <label>Zoom:</label>
            <input type="range" id="zoom" min="0.2" max="3.0" step="0.1" value="1.0">
            <span class="value" id="zoomVal">1.0</span>
        </div>
        
        <div class="control-group">
            <label>Resolution:</label>
            <input type="range" id="resolution" min="50" max="400" step="10" value="200">
            <span class="value" id="resolutionVal">200</span>
        </div>
        
        <div class="control-group">
            <label>Line Alpha:</label>
            <input type="range" id="lineAlpha" min="0.1" max="1.0" step="0.1" value="0.6">
            <span class="value" id="lineAlphaVal">0.6</span>
        </div>
    </div>
    <canvas id="canvas" width="960" height="720"></canvas>

	</div>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let centerX = canvas.width / 2;
        let centerY = canvas.height / 2;
        
        const controls = {
            showAxes: document.getElementById('showAxes'),
            showTranscendental: document.getElementById('showTranscendental'),
            radicalMode: document.getElementById('radicalMode'),
            zoom: document.getElementById('zoom'),
            resolution: document.getElementById('resolution'),
            lineAlpha: document.getElementById('lineAlpha')
        };
        
        const values = {
            zoomVal: document.getElementById('zoomVal'),
            resolutionVal: document.getElementById('resolutionVal'),
            lineAlphaVal: document.getElementById('lineAlphaVal')
        };
        
        // Update displays
        controls.zoom.addEventListener('input', (e) => {
            values.zoomVal.textContent = e.target.value;
            render();
        });
        controls.resolution.addEventListener('input', (e) => {
            values.resolutionVal.textContent = e.target.value;
            render();
        });
        controls.lineAlpha.addEventListener('input', (e) => {
            values.lineAlphaVal.textContent = e.target.value;
            render();
        });
        
        function hideControls() {
            const contentElement = document.getElementById("controlsContainer");
            if (contentElement.style.display === "none") {
                contentElement.style.display = "block";
            } else {
                contentElement.style.display = "none";
            }
        }

        // Trigger render on checkbox changes
        Object.keys(controls).forEach(key => {
            if (controls[key].type === 'checkbox') {
                controls[key].addEventListener('change', render);
            }
        });
        
        // RAU (Radical Angle Unit) functions
        function fastInvSqrt(x) {
            // Approximation for 1/sqrt(x)
            return 1.0 / Math.sqrt(x);
        }
        
        function rauSin(t) {
            // Normalize t to [0, 4) range
            t = ((t % 4) + 4) % 4;
            const quadrant = Math.floor(t);
            const local = t - quadrant;
            
            // Base radical functions
            const a = 1.0 - 2.0 * local + 2.0 * local * local;
            const invSqrtA = fastInvSqrt(a);
            const s = local * invSqrtA;
            const c = (1.0 - local) * invSqrtA;
            
            // Quadrant mapping
            switch(quadrant) {
                case 0: return s;
                case 1: return c;
                case 2: return -s;
                case 3: return -c;
                default: return 0;
            }
        }
        
        function rauCos(t) {
            // Normalize t to [0, 4) range
            t = ((t % 4) + 4) % 4;
            const quadrant = Math.floor(t);
            const local = t - quadrant;
            
            // Base radical functions
            const a = 1.0 - 2.0 * local + 2.0 * local * local;
            const invSqrtA = fastInvSqrt(a);
            const s = local * invSqrtA;
            const c = (1.0 - local) * invSqrtA;
            
            // Quadrant mapping
            switch(quadrant) {
                case 0: return c;
                case 1: return -s;
                case 2: return -c;
                case 3: return s;
                default: return 1;
            }
        }
        
        // Convert canvas coordinates to world coordinates
        function canvasToWorld(x, y, zoom) {
            return {
                x: (x - centerX) / (centerX * 0.8) * zoom,
                y: -(y - centerY) / (centerY * 0.8) * zoom
            };
        }
        
        // Convert world coordinates to canvas coordinates
        function worldToCanvas(x, y, zoom) {
            return {
                x: centerX + (x / zoom) * (centerX * 0.8),
                y: centerY - (y / zoom) * (centerY * 0.8)
            };
        }
        
        // Evaluate transcendental equation
        function evaluateTranscendental(x, y, useRadical) {
            if (Math.abs(x) < 0.01 || Math.abs(y) < 0.01) return null;
            
            let cosX, sinY;
            
            if (useRadical) {
                // RAU mode: use 4.0 instead of PI
                cosX = rauCos(4.0 / x);
                sinY = rauSin(4.0 / y);
            } else {
                // Standard mode: use PI
                cosX = Math.cos(Math.PI / x);
                sinY = Math.sin(Math.PI / y);
            }
            
            return cosX * cosX + sinY * sinY;
        }
        
        // Draw transcendental equation curves
        function drawTranscendental(zoom, resolution, alpha, useRadical) {
            ctx.strokeStyle = `rgba(255, 0, 255, ${alpha})`;
            ctx.lineWidth = 2;
            
            const step = canvas.width / resolution;
            
            // Scan through pixels and find where equation â‰ˆ 1
            for (let px = 0; px < canvas.width; px += step) {
                for (let py = 0; py < canvas.height; py += step) {
                    const world = canvasToWorld(px, py, zoom);
                    const val = evaluateTranscendental(world.x, world.y, useRadical);
                    
                    if (val !== null && Math.abs(val - 1.0) < 0.5) {
                        // Check neighbors to draw continuous lines
                        const worldRight = canvasToWorld(px + step, py, zoom);
                        const worldDown = canvasToWorld(px, py + step, zoom);
                        
                        const valRight = evaluateTranscendental(worldRight.x, worldRight.y, useRadical);
                        const valDown = evaluateTranscendental(worldDown.x, worldDown.y, useRadical);
                        
                        ctx.beginPath();
                        
                        if (valRight !== null && Math.abs(valRight - 1.0) < 0.15) {
                            ctx.moveTo(px, py);
                            ctx.lineTo(px + step, py);
                        }
                        
                        if (valDown !== null && Math.abs(valDown - 1.0) < 0.15) {
                            ctx.moveTo(px, py);
                            ctx.lineTo(px, py + step);
                        }
                        
                        ctx.stroke();
                    }
                }
            }
        }
        
        // Draw axes
        function drawAxes(zoom, alpha) {
            ctx.strokeStyle = `rgba(255, 255, 255, ${alpha * 0.4})`;
            ctx.lineWidth = 2;
            
            const extent = 10;
            
            // X-axis
            const xLeft = worldToCanvas(-extent, 0, zoom);
            const xRight = worldToCanvas(extent, 0, zoom);
            ctx.beginPath();
            ctx.moveTo(xLeft.x, xLeft.y);
            ctx.lineTo(xRight.x, xRight.y);
            ctx.stroke();
            
            // Y-axis
            const yTop = worldToCanvas(0, extent, zoom);
            const yBottom = worldToCanvas(0, -extent, zoom);
            ctx.beginPath();
            ctx.moveTo(yTop.x, yTop.y);
            ctx.lineTo(yBottom.x, yBottom.y);
            ctx.stroke();

            // Draw center point
            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            ctx.beginPath();
            ctx.arc(centerX, centerY, 4, 0, Math.PI * 2);
            ctx.fill();
            ctx.stroke();
        }
        
        // Main render function
        function render() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const zoom = parseFloat(controls.zoom.value);
            const resolution = parseInt(controls.resolution.value);
            const alpha = parseFloat(controls.lineAlpha.value);
            const useRadical = controls.radicalMode.checked;
            
            // Draw in order (back to front)
            if (controls.showAxes.checked) {
                drawAxes(zoom, alpha);
            }
            if (controls.showTranscendental.checked) {
            	drawTranscendental(zoom, resolution, alpha, useRadical);
            }
            
        }

        // Initial render
        render();
	  
        function cancelFullScreen() {
            var el = document;
            var requestMethod = el.cancelFullScreen||el.webkitCancelFullScreen||el.mozCancelFullScreen||el.exitFullscreen||el.webkitExitFullscreen;
            if (requestMethod) { // cancel full screen.
                requestMethod.call(el);
            } else if (typeof window.ActiveXObject !== "undefined") { // Older IE.
                var wscript = new ActiveXObject("WScript.Shell");
                if (wscript !== null) {
                    wscript.SendKeys("{F11}");
                }
            }
        }

        function requestFullScreen(el) {
            // Supports most browsers and their versions.
            var requestMethod = el.requestFullScreen || el.webkitRequestFullScreen || el.mozRequestFullScreen || el.msRequestFullscreen;

            if (requestMethod) { // Native full screen.
                requestMethod.call(el);
            } else if (typeof window.ActiveXObject !== "undefined") { // Older IE.
                var wscript = new ActiveXObject("WScript.Shell");
                if (wscript !== null) {
                    wscript.SendKeys("{F11}");
                }
            }
            return false
        }
	  
        // Fullscreen toggle
        const fullscreenToggle = document.getElementById('fullscreenToggle');
        fullscreenToggle.addEventListener('click', () => {
            canvas.classList.toggle('fullscreen');
            var isInFullScreen = (document.fullScreenElement && document.fullScreenElement !== null) ||  (document.mozFullScreen || document.webkitIsFullScreen);

            // Update canvas resolution when toggling fullscreen
            if (canvas.classList.contains('fullscreen')) {
                canvas.height = canvas.height*2;
                canvas.width = canvas.width*2;
				canvas.style.top = (parseInt(canvas.style.top) || 0 - 50) + 'px';
				if (!el) {
                el = document.body; // Make the body go full screen.
				}

				requestFullScreen(el);
				var el = document.documentElement,
					rfs = el.requestFullscreen;
				if(typeof rfs!="undefined" && rfs){
					rfs.call(el);
				}
            } else {
				cancelFullScreen();

				canvas.style.top = '0px';
                canvas.width = 960;
                canvas.height = 720;
            }
            
            // Update center coordinates
            centerX = canvas.width / 2;
            centerY = canvas.height / 2;
            render();
        });
    </script>
</body>
</html>
